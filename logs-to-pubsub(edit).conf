input {
  beats {
    port => 5045
  }
}

filter {
  # JSON 로그 파싱: Filebeat가 전달한 병합된 메시지를 JSON 객체로 변환
  json {
    source => "message"
    # JSON 파싱 후 원본 "message" 필드 제거 (필요 시)
    remove_field => ["message"]
  }
  
  # "timestamp" 필드가 문자열로 되어 있으므로 date 필터로 변환 (형식이 "10/Feb/2025:00:10:08 +0000"인 경우)
  date {
    match => [ "timestamp", "dd/MMM/yyyy:HH:mm:ss Z" ]
    target => "@timestamp"
    remove_field => ["timestamp"]
  }
}

output {
  kafka {
    bootstrap_servers => "${LOGSTASH_KAFKA_ENDPOINT}"
    topic_id => "nginx-topic"
    codec => json
  }
}
